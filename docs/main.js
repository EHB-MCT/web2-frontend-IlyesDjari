/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/app.js":
/*!********************!*\
  !*** ./src/app.js ***!
  \********************/
/***/ (() => {

eval("var redirect_uri = \"http://127.0.0.1:5500/web2-frontend-IlyesDjari/docs/pages/home.html\";\nvar client_id = \"75d6012515364a608ebbf7ec5113308c\";\nvar client_secret = \"e9069eeeb800474394cbe578f1a93c67\";\nvar access_token = null;\nvar refresh_token = null;\n\nconst AUTHORIZE = \"https://accounts.spotify.com/authorize\";\nconst TOKEN = \"https://accounts.spotify.com/api/token\";\nconst PLAYER = \"https://api.spotify.com/v1/me/player\";\nconst CURRENTLYPLAYING = \"https://api.spotify.com/v1/me/player/currently-playing\";\nconst PROFILE = \"https://api.spotify.com/v1/me\";\nconst CHOICES = [];\n\ndocument.documentElement.addEventListener(\"load\", function () {\n    document.getElementById(\"loader\").style.display = \"block\";\n});\n\nwindow.addEventListener(\"load\", function () {\n    document.getElementById(\"loader\").style.display = \"none\";\n});\n\nfunction onPageLoad() {\n    client_id = localStorage.getItem(\"client_id\");\n    client_secret = localStorage.getItem(\"client_secret\");\n\n    if (window.location.search.length > 0) {\n        handleRedirect();\n    } else {\n        access_token = localStorage.getItem(\"access_token\");\n        if (access_token == null) {\n            document.getElementById(\"tokenSection\").style.display = 'block';\n        } else {\n            userInformation();\n            currentlyPlaying();\n            newRelease();\n        }\n    }\n}\n\nfunction handleRedirect() {\n    let code = getCode();\n    fetchAccessToken(code);\n    window.history.pushState(\"\", \"\", redirect_uri);\n}\n\nfunction getCode() {\n    let code = null;\n    const queryString = window.location.search;\n    if (queryString.length > 0) {\n        const urlParams = new URLSearchParams(queryString);\n        code = urlParams.get('code');\n    }\n    return code;\n}\n\nfunction requestAuthorization() {\n    client_id = '75d6012515364a608ebbf7ec5113308c';\n    client_secret = 'e9069eeeb800474394cbe578f1a93c67';\n    localStorage.setItem(\"client_id\", client_id);\n    localStorage.setItem(\"client_secret\", client_secret);\n    let url = AUTHORIZE;\n    url += \"?client_id=\" + client_id;\n    url += \"&response_type=code\";\n    url += \"&redirect_uri=\" + encodeURI(redirect_uri);\n    url += \"&show_dialog=true\";\n    url += \"&scope=user-read-private user-read-email user-modify-playback-state user-read-playback-position user-library-read streaming user-read-playback-state user-read-recently-played playlist-read-private\";\n    window.location.href = url;\n}\n\nfunction fetchAccessToken(code) {\n    let body = \"grant_type=authorization_code\";\n    body += \"&code=\" + code;\n    body += \"&redirect_uri=\" + encodeURI(redirect_uri);\n    body += \"&client_id=\" + client_id;\n    body += \"&client_secret=\" + client_secret;\n    callAuthorizationApi(body);\n}\n\nfunction refreshAccessToken() {\n    refresh_token = localStorage.getItem(\"refresh_token\");\n    let body = \"grant_type=refresh_token\";\n    body += \"&refresh_token=\" + refresh_token;\n    body += \"&client_id=\" + client_id;\n    callAuthorizationApi(body);\n}\n\nfunction callAuthorizationApi(body) {\n    let xhr = new XMLHttpRequest();\n    xhr.open(\"POST\", TOKEN, true);\n    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');\n    xhr.setRequestHeader('Authorization', 'Basic ' + btoa(client_id + \":\" + client_secret));\n    xhr.send(body);\n    xhr.onload = handleAuthorizationResponse;\n}\n\nfunction handleAuthorizationResponse() {\n    if (this.status == 200) {\n        var data = JSON.parse(this.responseText);\n        console.log(data);\n        if (data.access_token != undefined) {\n            access_token = data.access_token;\n            localStorage.setItem(\"access_token\", access_token);\n        }\n        if (data.refresh_token != undefined) {\n            refresh_token = data.refresh_token;\n            localStorage.setItem(\"refresh_token\", refresh_token);\n        }\n        onPageLoad();\n    } else {\n        console.log(this.responseText);\n        alert(this.responseText);\n    }\n}\n\nfunction callApi(method, url, body, callback) {\n    let xhr = new XMLHttpRequest();\n    xhr.open(method, url, true);\n    xhr.setRequestHeader('Content-Type', 'application/json');\n    xhr.setRequestHeader('Authorization', 'Bearer ' + access_token);\n    xhr.send(body);\n    xhr.onload = callback;\n}\n\nfunction handleApiResponse() {\n    if (this.status == 200) {\n        console.log(this.responseText);\n        setTimeout(currentlyPlaying, 2000);\n    } else if (this.status == 204) {\n        setTimeout(currentlyPlaying, 2000);\n    } else if (this.status == 401) {\n        refreshAccessToken();\n    } else {\n        console.log(this.responseText);\n    }\n}\n\nfunction newRelease() {\n    var x = Math.floor(Math.random() * 20);\n    const RELEASE = `https://api.spotify.com/v1/browse/new-releases?country=BE&limit=5&offset=${x}`;\n    callApi(\"GET\", RELEASE, null, newRealeaseResponse);\n}\n\nfunction currentlyPlaying() {\n    callApi(\"GET\", PLAYER, null, handleCurrentlyPlayingResponse);\n\n}\n\nfunction userInformation() {\n    callApi(\"GET\", PROFILE, null, userResponse);\n}\n\nfunction userResponse() {\n    var data = JSON.parse(this.responseText);\n    const time = new Date().getHours();\n    if (data != null) {\n        document.getElementById(\"username\").innerHTML = data.display_name;\n        document.getElementById(\"userpicture\").src = data.images[0].url;\n\n        if (time < 12) {\n            document.getElementById(\"daytime\").innerHTML = \"Good morning, \";\n        } else if (time < 18) {\n            document.getElementById(\"daytime\").innerHTML = \"Good afternoon, \";\n        } else {\n            document.getElementById(\"daytime\").innerHTML = \"Good evening, \";\n        }\n    } else if (this.status == 401) {\n        refreshAccessToken();\n    }\n}\n\n\nfunction handleCurrentlyPlayingResponse() {\n    var data = JSON.parse(this.responseText);\n    console.log(data);\n    if (this.status == 200) {\n        if (data.item != null) {\n            document.getElementById(\"imgcurrent\").src = data.item.album.images[0].url;\n            document.getElementById(\"artistcurrent\").innerHTML = data.item.artists[0].name;\n            document.getElementById(\"songcurrent\").innerHTML = data.item.name;\n            //setTimeout(currentlyPlaying, 1000); \n        }\n    } else if (this.status == 401) {\n        refreshAccessToken();\n    }\n}\n\n\nfunction newRealeaseResponse() {\n    var data = JSON.parse(this.responseText);\n    console.log(data);\n    if (data.albums != null) {\n        for (let i = 0; i < 5; i++) {\n            document.getElementById(\"release\").insertAdjacentHTML('afterbegin', `\n            <a href=\"${data.albums.items[i].external_urls.spotify}\"\">\n            <div>\n            <img src=\"${data.albums.items[i].images[0].url}\" alt=\"cover\">\n            <h3>${data.albums.items[i].artists[0].name}</h3>\n            <p>${data.albums.items[i].name}</p>\n            </div>\n            </a>`);\n        }\n    } else if (this.status == 401) {\n        refreshAccessToken();\n    }\n}\n\n\nfunction reply_click(clicked_id) {\n    CHOICES.push(clicked_id);\n    console.log(CHOICES);\n    document.getElementById(\"choices\").style.display = \"none\";\n    document.getElementById(\"lengthtimeline\").style.backgroundColor = \"#A065FF\";\n    document.getElementById(\"lengthtimeline\").style.width = \"22.5vw\";\n    document.getElementById(\"genre\").style.transform = \"scale(1)\";\n    document.getElementById(\"mood\").style.transform = \"scale(1.1)\";\n    document.getElementById(\"mood\").style.backgroundColor = \"#A065FF\";\n    document.getElementById(\"moodimg\").style.opacity = \"1\";\n    document.getElementById(\"choicesmood\").style.display = \"flex\";\n    document.getElementById(\"generate\").style.display = \"none\";\n}\n\n//# sourceURL=webpack://web2-frontend-ilyesdjari/./src/app.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/app.js"]();
/******/ 	
/******/ })()
;